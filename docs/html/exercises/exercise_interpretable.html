<!DOCTYPE html> <html lang=en > <meta charset=utf-8  /> <meta name=viewport  content="width=device-width, initial-scale=1.0" /><meta name=generator  content="Docutils 0.17.1: http://docutils.sourceforge.net/" /> <meta name=viewport  content="width=device-width,initial-scale=1"> <meta http-equiv=x-ua-compatible  content="ie=edge"> <meta name="lang:clipboard.copy" content="Copy to clipboard"> <meta name="lang:clipboard.copied" content="Copied to clipboard"> <meta name="lang:search.language" content=en > <meta name="lang:search.pipeline.stopwords" content=True > <meta name="lang:search.pipeline.trimmer" content=True > <meta name="lang:search.result.none" content="No matching documents"> <meta name="lang:search.result.one" content="1 matching document"> <meta name="lang:search.result.other" content="# matching documents"> <meta name="lang:search.tokenizer" content="[\s\-]+"> <link href="https://fonts.gstatic.com/" rel=preconnect  crossorigin> <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel=stylesheet > <style> body, input { font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif } code, kbd, pre { font-family: "Roboto Mono", "Courier New", Courier, monospace } </style> <link rel=stylesheet  href="../_static/stylesheets/application.css"/> <link rel=stylesheet  href="../_static/stylesheets/application-palette.css"/> <link rel=stylesheet  href="../_static/stylesheets/application-fixes.css"/> <link rel=stylesheet  href="../_static/fonts/material-icons.css"/> <meta name=theme-color  content="#2196f3"> <script src="../_static/javascripts/modernizr.js"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-151397036-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'UA-151397036-1'); </script> <title>Interpretable Modelling of Credit Risk &#8212; Unifying Data Science</title> <link rel=stylesheet  type="text/css" href="../_static/pygments.css" /> <link rel=stylesheet  type="text/css" href="../_static/material.css" /> <script data-url_root="../" id=documentation_options  src="../_static/documentation_options.js"></script> <script src="../_static/jquery.js"></script> <script src="../_static/underscore.js"></script> <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script> <script src="../_static/doctools.js"></script> <script crossorigin=anonymous  integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script> <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script> <script defer=defer  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script> <link rel="shortcut icon" href="../_static/mids_logo.svg"/> <link rel=index  title=Index  href="../genindex.html" /> <link rel=search  title=Search  href="../search.html" /> <body dir=ltr data-md-color-primary=blue-grey data-md-color-accent=blue> <svg class=md-svg > <defs data-children-count=0 > <svg xmlns="http://www.w3.org/2000/svg" width=416  height=448  viewBox="0 0 416 448" id=__github ><path fill=currentColor  d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg> </defs> </svg> <input class=md-toggle  data-md-toggle=drawer  type=checkbox  id=__drawer > <input class=md-toggle  data-md-toggle=search  type=checkbox  id=__search > <label class=md-overlay  data-md-component=overlay  for=__drawer ></label> <a href="#exercises/exercise_interpretable" tabindex=1  class=md-skip > Skip to content </a> <header class=md-header  data-md-component=header > <nav class="md-header-nav md-grid"> <div class="md-flex navheader"> <div class="md-flex__cell md-flex__cell--shrink"> <a href="../index.html" title="Unifying Data Science" class="md-header-nav__button md-logo"> <img src="../_static/mids_logo.svg" height=26  alt="Unifying Data Science logo"> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer ></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title > <span class=md-header-nav__topic >Unifying Data Science</span> <span class=md-header-nav__topic > Interpretable Modelling of Credit Risk </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search ></label> <div class=md-search  data-md-component=search  role=dialog > <label class=md-search__overlay  for=__search ></label> <div class=md-search__inner  role=search > <form class=md-search__form  action="../search.html" method=get  name=search > <input type=text  class=md-search__input  name=q  placeholder=""Search"" autocapitalize=off  autocomplete=off  spellcheck=false  data-md-component=query  data-md-state=active > <label class="md-icon md-search__icon" for=__search ></label> <button type=reset  class="md-icon md-search__icon" data-md-component=reset  tabindex=-1 > &#xE5CD; </button> </form> <div class=md-search__output > <div class=md-search__scrollwrap  data-md-scrollfix> <div class=md-search-result  data-md-component=result > <div class=md-search-result__meta > Type to start searching </div> <ol class=md-search-result__list ></ol> </div> </div> </div> </div> </div> </div> <script src="../_static/javascripts/version_dropdown.js"></script> <script> var json_loc = "../"versions.json"", target_loc = "../../", text = "Versions"; $( document ).ready( add_version_dropdown(json_loc, target_loc, text)); </script> </div> </nav> </header> <div class=md-container > <nav class=md-tabs  data-md-component=tabs > <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list > <li class=md-tabs__item ><a href="../index.html" class=md-tabs__link >Home</a> <li class=md-tabs__item ><a href="../class_schedule.html" class=md-tabs__link >Class Schedule</a> <li class=md-tabs__item ><a href="../topic_list.html" class=md-tabs__link >Topic List</a> <li class=md-tabs__item ><a href="https://www.nickeubank.com" class=md-tabs__link >About The Author</a> </ul> </div> </nav> <main class=md-main > <div class="md-main__inner md-grid" data-md-component=container > <div class="md-sidebar md-sidebar--primary" data-md-component=navigation > <div class=md-sidebar__scrollwrap > <div class=md-sidebar__inner > <nav class="md-nav md-nav--primary" data-md-level=0 > <label class="md-nav__title md-nav__title--site" for=__drawer > <a href="../index.html" title="Unifying Data Science" class="md-nav__button md-logo"> <img src="../_static/mids_logo.svg" alt=" logo" width=48  height=48 > </a> <a href="../index.html" title="Unifying Data Science">Unifying Data Science</a> </label> <ul class=md-nav__list > <li class=md-nav__item > <a href="../class_schedule.html" class=md-nav__link >CLASS SCHEDULE</a> <li class=md-nav__item > <span class="md-nav__link caption"><span class=caption-text >Causal Inference</span></span> <li class=md-nav__item > <a href="../limitations_of_ATE.html" class=md-nav__link >Limitations of ATE</a> <li class=md-nav__item > <a href="../internal_v_external_validity.html" class=md-nav__link >Internal v. External Validity</a> <li class=md-nav__item > <a href="../evaluating_real_studies.html" class=md-nav__link >Evaluating A Real Study</a> <li class=md-nav__item > <a href="../causal_inference_beyond_ab_testing.html" class=md-nav__link >Beyond AB Testing</a> <li class=md-nav__item > <a href="../matching_why.html" class=md-nav__link >Matching (Why)</a> <li class=md-nav__item > <a href="../matching_how.html" class=md-nav__link >Matching (How)</a> <li class=md-nav__item > <a href="../interpreting_indicator_vars.html" class=md-nav__link >Indicator Variables</a> <li class=md-nav__item > <a href="../fixed_effects.html" class=md-nav__link >Fixed Effects (FEs)</a> <li class=md-nav__item > <a href="../fixed_effects_and_causal_inference.html" class=md-nav__link >FEs & Causality</a> <li class=md-nav__item > <a href="../fixed_effects_v_hierarchical.html" class=md-nav__link >FEs & Hierarchical Models</a> <li class=md-nav__item > <span class="md-nav__link caption"><span class=caption-text >Data Science Project Design</span></span> <li class=md-nav__item > <a href="../backwards_design.html" class=md-nav__link >Backwards Design</a> <li class=md-nav__item > <a href="../taxonomy_of_questions.html" class=md-nav__link >Taxonomy of Questions</a> <li class=md-nav__item > <a href="../moving_from_problems_to_questions.html" class=md-nav__link >From Problems to Questions</a> <li class=md-nav__item > <a href="../descriptive_questions.html" class=md-nav__link >Discretion and Description</a> <li class=md-nav__item > <a href="../ethical_ml_recommendations.html" class=md-nav__link >Ethical Machine Learning</a> <li class=md-nav__item > <a href="../writing_to_stakeholders.html" class=md-nav__link >Writing for Lay Audiences</a> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc > <div class=md-sidebar__scrollwrap > <div class=md-sidebar__inner > <nav class="md-nav md-nav--secondary"> <label class=md-nav__title  for=__toc >"Contents"</label> <ul class=md-nav__list  data-md-scrollfix=""> <li class=md-nav__item ><a href="#exercises-exercise-interpretable--page-root" class=md-nav__link >Interpretable Modelling of Credit Risk</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#Data-Prep" class=md-nav__link >Data Prep</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#Exercise-1" class=md-nav__link >Exercise 1</a> <li class=md-nav__item ><a href="#Exercise-2" class=md-nav__link >Exercise 2</a> <li class=md-nav__item ><a href="#Exercise-3" class=md-nav__link >Exercise 3</a> <li class=md-nav__item ><a href="#Exercise-4" class=md-nav__link >Exercise 4</a> </ul> </nav> <li class=md-nav__item ><a href="#Model-Fitting" class=md-nav__link >Model Fitting</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#Exercise-5" class=md-nav__link >Exercise 5</a> <li class=md-nav__item ><a href="#Exercise-6" class=md-nav__link >Exercise 6</a> <li class=md-nav__item ><a href="#Exercise-7" class=md-nav__link >Exercise 7</a> <li class=md-nav__item ><a href="#Exercise-8" class=md-nav__link >Exercise 8</a> </ul> </nav> <li class=md-nav__item ><a href="#Let&#39;s-See-This-Interpretability!" class=md-nav__link >Let’s See This Interpretability!</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#Exercise-9" class=md-nav__link >Exercise 9</a> <li class=md-nav__item ><a href="#Exercise-10" class=md-nav__link >Exercise 10</a> <li class=md-nav__item ><a href="#Exercise-11" class=md-nav__link >Exercise 11</a> <li class=md-nav__item ><a href="#Exercise-12" class=md-nav__link >Exercise 12</a> <li class=md-nav__item ><a href="#Exercise-13" class=md-nav__link >Exercise 13</a> <li class=md-nav__item ><a href="#Exercise-14" class=md-nav__link >Exercise 14</a> <li class=md-nav__item ><a href="#Exercise-15" class=md-nav__link >Exercise 15</a> <li class=md-nav__item ><a href="#Exercise-16" class=md-nav__link >Exercise 16</a> <li class=md-nav__item ><a href="#Exercise-17" class=md-nav__link >Exercise 17</a> </ul> </nav> </ul> </nav> </ul> </nav> </div> </div> </div> <div class=md-content > <article class="md-content__inner md-typeset" role=main > <section id=Interpretable-Modelling-of-Credit-Risk > <h1 id=exercises-exercise-interpretable--page-root >Interpretable Modelling of Credit Risk<a class=headerlink  href="#exercises-exercise-interpretable--page-root" title="Permalink to this heading">¶</a></h1> <p>As detailed in Cynthia Rudin’s excellent commentary on interpretability <a class="reference external" href="https://arxiv.org/abs/1811.10154">(ArXiV version here)</a>, there are a plethora of reasons to avoid the use of black box models when models are being used to make high stakes decisions to may have life-altering effects on real people. Efforts to develop “explainable black box models,” while appealing for their potential to let us continuing using the same tools we always have and to creation explanations after the fact, are inherently flawed. As Rudin notes in my single favorite passage from her paper:</p> <blockquote> <div><p>Explainable ML methods provide explanations that are not faithful to what the original model computes. Explanations must be wrong. They cannot have perfect fidelity with respect to the original model. If the explanation was completely faithful to what the original model computes, the explanation would equal the original model, and one would not need the original model in the first place, only the explanation. (In other words, this is a case where the original model would be interpretable.) This leads to the danger that any explanation method for a black box model can be an inaccurate representation of the original model in parts of the feature space.</p> <p>An inaccurate (low-fidelity) explanation model limits trust in the explanation, and by extension, trust in the black box that it is trying to explain. An explainable model that has a 90% agreement with the original model indeed explains the original model most of the time. However, an explanation model that is correct 90% of the time is wrong 10% of the time. If a tenth of the explanations are incorrect, one cannot trust the explanations, and thus one cannot trust the original black box. If we cannot know for certain whether our explanation is correct, we cannot know whether to trust either the explanation or the original model.</p> </div></blockquote> <p>With this motivation in mind, in this exercise, we will use a cutting edge interpretable modeling framework to model credit risk using data from the <a class="reference external" href="https://pakdd.org/archive/pakdd2010/">14th Pacific-Asia Knowledge Discovery and Data Mining conference (PAKDD 2010)</a>. This data covers the period of 2006 to 2009, and “comes from a private label credit card operation of a Brazilian credit company and its partner shops.” (The competition was won by <a class="reference external" href="https://timi.eu/blog/news/timi-top-winner-at-the-pakdd-2010-cup/">TIMi</a>, who purely by coincidence helped me complete my PhD dissertation research!).</p> <p>We will be working with Generalized Additive Models (GAMs) (not to be confused with Generalized <em>Linear</em> Models (GLMs) — GLMs are a special case of GAMs). In particular, we will be using the <a class="reference external" href="https://pygam.readthedocs.io/en/latest/notebooks/tour_of_pygam.html">pyGAM</a>, though this is far from the only GAM implementation out there. <a class="reference external" href="https://nicholasjclark.github.io/mvgam/">mvgam</a> in R is probably considered the gold standard, as it was developed by a pioneering researcher of GAMs. <code class="docutils literal notranslate"><span class=pre >statsmodels</span></code> also has <a class="reference external" href="https://www.statsmodels.org/stable/gam.html">an implementation</a>, and GAM is also hiding in plain sight behind many other tools, like Meta’s <a class="reference external" href="https://facebook.github.io/prophet/">Prophet</a> time series forecasting library (which is GAM-based).</p> <section id=Data-Prep > <h2 id=Data-Prep >Data Prep<a class=headerlink  href="#Data-Prep" title="Permalink to this heading">¶</a></h2> <section id=Exercise-1 > <h3 id=Exercise-1 >Exercise 1<a class=headerlink  href="#Exercise-1" title="Permalink to this heading">¶</a></h3> <p>The PADD 2010 data is in <a class="reference external" href="https://github.com/nickeubank/MIDS_Data/tree/master/PAKDD%202010">this repository</a>. You can find column names in <code class="docutils literal notranslate"><span class=pre >PAKDD2010_VariablesList.XLS</span></code> and the actual data in <code class="docutils literal notranslate"><span class=pre >PAKDD2010_Modeling_Data.txt</span></code>.</p> <p>Note: you may run into a string-encoding issue loading the <code class="docutils literal notranslate"><span class=pre >PAKDD2010_Modeling_Data.txt</span></code> data. All I’ll say is that most latin-based languages used <code class="docutils literal notranslate"><span class=pre >latin8</span></code> as a text encoding prior to broad adoption of UTF-8. (Don’t know about UTF? <a class="reference external" href="https://www.youtube.com/watch?v=MijmeoH9LT4">Check out this video</a>!)</p> <p>Load the data (including column names).</p> </section> <section id=Exercise-2 > <h3 id=Exercise-2 >Exercise 2<a class=headerlink  href="#Exercise-2" title="Permalink to this heading">¶</a></h3> <p>There are a few variables with a lot of missing values (more than half missing). Given the limited documentation for this data it’s a little hard to be sure why, but given the effect on sample size and what variables are missing, let’s go ahead and drop them. You you end up dropping 6 variables.</p> <p>Hint: Some variables have missing values that aren’t immediately obviously.</p> <p>(This is not strictly necessary at this stage, given we’ll be doing more feature selection down the line, but keeps things easier knowing we don’t have to worry about missingness later.)</p> </section> <section id=Exercise-3 > <h3 id=Exercise-3 >Exercise 3<a class=headerlink  href="#Exercise-3" title="Permalink to this heading">¶</a></h3> <p>Let’s start off by fitting a model that uses the following variables:</p> <div class="highlight-none notranslate"><div class=highlight ><pre><span></span>"QUANT_DEPENDANTS",
"QUANT_CARS",
"MONTHS_IN_RESIDENCE",
"PERSONAL_MONTHLY_INCOME",
"QUANT_BANKING_ACCOUNTS",
"AGE",
"SEX",
"MARITAL_STATUS",
"OCCUPATION_TYPE",
"RESIDENCE_TYPE",
"RESIDENCIAL_STATE",
"RESIDENCIAL_CITY",
"RESIDENCIAL_BOROUGH",
"RESIDENCIAL_ZIP_3"
</pre></div> </div> <p>(GAMs don’t have any automatic feature selection methods, so these are based on my own sense of features that are likely to matter. A fully analysis would entail a few passes at feature refinement)</p> <p>Plot and otherwise characterize the distributions of all the variables we may use. If you see anything bananas, adjust how terms enter your model. Yes, pyGAM has flexible functional forms, but giving the model features that are engineered to be more substantively meaningful (e.g., taking log of income) will aid model estimation.</p> <p>You should probably do something about the functional form of <em>at least</em> <code class="docutils literal notranslate"><span class=pre >PERSONAL_MONTHLY_INCOME</span></code>, and <code class="docutils literal notranslate"><span class=pre >QUANT_DEPENDANTS</span></code>.</p> </section> <section id=Exercise-4 > <h3 id=Exercise-4 >Exercise 4<a class=headerlink  href="#Exercise-4" title="Permalink to this heading">¶</a></h3> <p>Geographic segregation means residency data often contains LOTS of information. But there’s a problem with <code class="docutils literal notranslate"><span class=pre >RESIDENCIAL_CITY</span></code> and <code class="docutils literal notranslate"><span class=pre >RESIDENCIAL_BOROUGH</span></code>. What is the problem?</p> <p>In any real project, this would be something absolutely worth resolving, but for this exercise, we’ll just drop all three string <code class="docutils literal notranslate"><span class=pre >RESIDENCIAL_</span></code> variables.</p> </section> </section> <section id=Model-Fitting > <h2 id=Model-Fitting >Model Fitting<a class=headerlink  href="#Model-Fitting" title="Permalink to this heading">¶</a></h2> <section id=Exercise-5 > <h3 id=Exercise-5 >Exercise 5<a class=headerlink  href="#Exercise-5" title="Permalink to this heading">¶</a></h3> <p>First, use <code class="docutils literal notranslate"><span class=pre >train_test_split</span></code> to do an 80/20 split of your data. Then, using the <code class="docutils literal notranslate"><span class=pre >TARGET_LABEL_BAD</span></code> variable, fit a classification model on this data. Optimize with <code class="docutils literal notranslate"><span class=pre >gridsearch</span></code>. Use splines for continuous variables and factors for categoricals.</p> <p>At this point we’d <em>ideally</em> be working with 11 variables. However pyGAM can get a little slow with factor features with lots of values + lots of unique values (e.g., 50,000 observations and the <em>many</em> values of <code class="docutils literal notranslate"><span class=pre >RESIDENCIAL_ZIP</span></code> takes about 15 minutes on my computer). In that configuration, you should get a model fit in 10-15 seconds.</p> <p>So let’s start by fitting a model that also excludes <code class="docutils literal notranslate"><span class=pre >RESIDENCIAL_ZIP</span></code>.</p> </section> <section id=Exercise-6 > <h3 id=Exercise-6 >Exercise 6<a class=headerlink  href="#Exercise-6" title="Permalink to this heading">¶</a></h3> <p>Create a (naive) confusion matrix using the predicted values you get with <code class="docutils literal notranslate"><span class=pre >predict()</span></code> on your test data. Our stakeholder cares about two things:</p> <ul class=simple > <li><p>maximizing the number of people to whom they extend credit, and</p> <li><p>the false negative rate (the share of people identified as “safe bets” who aren’t, and who thus default).</p> </ul> <p>How many “good bets” does the model predict (true negatives), and what is the <a class="reference external" href="https://en.wikipedia.org/wiki/False_omission_rate">False Omission Rate</a> (the share of predicted negatives that are false negatives)?</p> <p>Looking at the confusion matrix, how did the model maximize accuracy?</p> </section> <section id=Exercise-7 > <h3 id=Exercise-7 >Exercise 7<a class=headerlink  href="#Exercise-7" title="Permalink to this heading">¶</a></h3> <p>Suppose your stakeholder wants to minimize false negative rates. How low of a <a class="reference external" href="https://en.wikipedia.org/wiki/False_omission_rate">False Omission Rate</a> (the share of predicted negatives that are false negatives) can you get (assuming more than, say, 10 true negatives), and how many “good bets” (true negatives) do they get at that risk level?</p> <p>Hint: use <code class="docutils literal notranslate"><span class=pre >predict_proba()</span></code></p> <p>Note: One <em>can</em> use class weights to shift the emphasis of the original model fitting, but for the moment let’s just play with <code class="docutils literal notranslate"><span class=pre >predict_proba()</span></code> and thresholds.</p> </section> <section id=Exercise-8 > <h3 id=Exercise-8 >Exercise 8<a class=headerlink  href="#Exercise-8" title="Permalink to this heading">¶</a></h3> <p>If the stakeholder wants to maximize true negatives and can tolerate a false omission rate of 19%, how many true negatives will they be able to enroll?</p> </section> </section> <section id="Let's-See-This-Interpretability!"> <h2 id="Let's-See-This-Interpretability!">Let’s See This Interpretability!<a class=headerlink  href="#Let's-See-This-Interpretability!" title="Permalink to this heading">¶</a></h2> <p>We’re using GAMs for their interpretability, so let’s use it!</p> <section id=Exercise-9 > <h3 id=Exercise-9 >Exercise 9<a class=headerlink  href="#Exercise-9" title="Permalink to this heading">¶</a></h3> <p>Plot the partial dependence plots for all your continuous factors with 95% confidence intervals (I have three, at this stage).</p> <p>If you get an error like this when generating <code class="docutils literal notranslate"><span class=pre >partial_dependence</span></code> errors:</p> <div class="highlight-python notranslate"><div class=highlight ><pre><span></span><span class=o >----&gt;</span> <span class=n >pdep</span><span class=p >,</span> <span class=n >confi</span> <span class=o >=</span> <span class=n >gam</span><span class=o >.</span><span class=n >partial_dependence</span><span class=p >(</span><span class=n >term</span><span class=o >=</span><span class=n >i</span><span class=p >,</span> <span class=n >X</span><span class=o >=</span><span class=n >XX</span><span class=p >,</span> <span class=n >width</span><span class=o >=</span><span class=mf >0.95</span><span class=p >)</span>

<span class=o >...</span>
<span class=ne >ValueError</span><span class=p >:</span> <span class=n >X</span> <span class=n >data</span> <span class=ow >is</span> <span class=n >out</span> <span class=n >of</span> <span class=n >domain</span> <span class=k >for</span> <span class=n >categorical</span> <span class=n >feature</span> <span class=mf >4.</span> <span class=n >Expected</span> <span class=n >data</span> <span class=n >on</span> <span class=p >[</span><span class=mf >1.0</span><span class=p >,</span> <span class=mf >2.0</span><span class=p >],</span> <span class=n >but</span> <span class=n >found</span> <span class=n >data</span> <span class=n >on</span> <span class=p >[</span><span class=mf >0.0</span><span class=p >,</span> <span class=mf >0.0</span><span class=p >]</span>
</pre></div> </div> <p>it’s because you have a variable set as a factor that doesn’t have values of <code class="docutils literal notranslate"><span class=pre >0</span></code>. pyGAM is assuming <code class="docutils literal notranslate"><span class=pre >0</span></code> is the excluded category. Just recode the variable to ensure 0 is used to identify one of the categories.</p> </section> <section id=Exercise-10 > <h3 id=Exercise-10 >Exercise 10<a class=headerlink  href="#Exercise-10" title="Permalink to this heading">¶</a></h3> <p>How does the partial correlation with respect to age look?</p> </section> <section id=Exercise-11 > <h3 id=Exercise-11 >Exercise 11<a class=headerlink  href="#Exercise-11" title="Permalink to this heading">¶</a></h3> <p>Refit your model, but this time impose <a class="reference external" href="https://pygam.readthedocs.io/en/latest/notebooks/tour_of_pygam.html#Penalties-/-Constraints">monotonicity or concavity/convexity</a> on the relationship between age and credit risk (which makes more sense to you?). Fit the model and plot the new partial dependence.</p> </section> <section id=Exercise-12 > <h3 id=Exercise-12 >Exercise 12<a class=headerlink  href="#Exercise-12" title="Permalink to this heading">¶</a></h3> <p>Functional form constraints are often about fairness or meeting regulatory requirements, but they can also prevent overfitting.</p> <p>Does this change the number of “true negatives” you can enroll below a false omission rate of 19%?</p> </section> <section id=Exercise-13 > <h3 id=Exercise-13 >Exercise 13<a class=headerlink  href="#Exercise-13" title="Permalink to this heading">¶</a></h3> <p>In the preceding exercises, we allowed pyGAM to choose its own smoothing parameters / coefficient penalties. This makes life easy, but it isn’t always optimal, especially because when it does so, it picks the same smoothing penalty (the <code class="docutils literal notranslate"><span class=pre >lambda</span></code> in <code class="docutils literal notranslate"><span class=pre >.summary()</span></code>) for all terms.</p> <p>(If you haven’t seen them let, penalities are designed to limit overfitting by, basically, “penalizing” big coefficients on different terms. This tends to push models towards smoother fits.)</p> <p><a class="reference external" href="https://pygam.readthedocs.io/en/latest/notebooks/quick_start.html#Automatically-tune-the-model">To get around this, we can do a grid or random search.</a> This is definitely a little slow, but let’s give it a try!</p> <p>Then following the model given in the docs linked above, let’s do a random search. Make sure your initial random points has a shape of <code class="docutils literal notranslate"><span class=pre >100</span> <span class=pre >x</span> <span class=pre >(the</span> <span class=pre >number</span> <span class=pre >of</span> <span class=pre >terms</span> <span class=pre >in</span> <span class=pre >your</span> <span class=pre >model)</span></code>.</p> </section> <section id=Exercise-14 > <h3 id=Exercise-14 >Exercise 14<a class=headerlink  href="#Exercise-14" title="Permalink to this heading">¶</a></h3> <p>How many true negatives can you get now at a less than 19% False Omission Rate?</p> </section> <section id=Exercise-15 > <h3 id=Exercise-15 >Exercise 15<a class=headerlink  href="#Exercise-15" title="Permalink to this heading">¶</a></h3> <p>Add an interaction term between age and personal income.</p> </section> <section id=Exercise-16 > <h3 id=Exercise-16 >Exercise 16<a class=headerlink  href="#Exercise-16" title="Permalink to this heading">¶</a></h3> <p>Now visualize the <a class="reference external" href="https://pygam.readthedocs.io/en/latest/notebooks/tour_of_pygam.html#Terms-and-Interactions">partial dependence interaction term.</a></p> </section> <section id=Exercise-17 > <h3 id=Exercise-17 >Exercise 17<a class=headerlink  href="#Exercise-17" title="Permalink to this heading">¶</a></h3> <p>Finally, another popular interpretable model is the <code class="docutils literal notranslate"><span class=pre >ExplainableBoostingClassifier</span></code>. You can learn more <a class="reference external" href="https://interpret.ml/docs/ebm.html">about it here</a>, though how much sense it will make to you may be limited if you aren’t familiar with gradient boosting yet. Still, at least one of your classmates prefers it to pyGAM, so give it a try using this code:</p> <div class="highlight-python notranslate"><div class=highlight ><pre><span></span><span class=kn >from</span> <span class=nn >interpret.glassbox</span> <span class=kn >import</span> <span class=n >ExplainableBoostingClassifier</span>
<span class=kn >from</span> <span class=nn >interpret</span> <span class=kn >import</span> <span class=n >show</span>
<span class=kn >import</span> <span class=nn >warnings</span>

<span class=n >ebm</span> <span class=o >=</span> <span class=n >ExplainableBoostingClassifier</span><span class=p >()</span>
<span class=n >ebm</span><span class=o >.</span><span class=n >fit</span><span class=p >(</span><span class=n >X_train</span><span class=p >,</span> <span class=n >y_train</span><span class=p >)</span>

<span class=k >with</span> <span class=n >warnings</span><span class=o >.</span><span class=n >catch_warnings</span><span class=p >():</span>
   <span class=n >warnings</span><span class=o >.</span><span class=n >simplefilter</span><span class=p >(</span><span class=s2 >"ignore"</span><span class=p >)</span>

   <span class=n >ebm_global</span> <span class=o >=</span> <span class=n >ebm</span><span class=o >.</span><span class=n >explain_global</span><span class=p >()</span>
   <span class=n >show</span><span class=p >(</span><span class=n >ebm_global</span><span class=p >)</span>

   <span class=n >ebm_local</span> <span class=o >=</span> <span class=n >ebm</span><span class=o >.</span><span class=n >explain_local</span><span class=p >(</span><span class=n >X_train</span><span class=p >,</span> <span class=n >y_train</span><span class=p >)</span>
   <span class=n >show</span><span class=p >(</span><span class=n >ebm_local</span><span class=p >)</span>
</pre></div> </div> </section> </section> </section> </article> </div> </div> </main> </div> <footer class=md-footer > <div class=md-footer-nav > <nav class="md-footer-nav__inner md-grid"> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright > <div class=md-footer-copyright__highlight > &#169; Copyright 2022, Nick Eubank. </div> Created using <a href="http://www.sphinx-doc.org/">Sphinx</a> 5.0.2. and <a href="https://github.com/bashtage/sphinx-material/">Material for Sphinx</a> </div> </div> </div> </footer> <script src="../_static/javascripts/application.js"></script> <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>